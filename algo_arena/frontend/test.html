<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlgoArena | Professional MVP</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS v4 -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    
    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style type="text/tailwindcss">
        @theme {
            --font-sans: 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
            
            /* Custom Colors */
            --color-bg-primary: #0f172a;
            --color-bg-secondary: #1e293b;
            --color-accent: #6366f1;
            --color-accent-glow: #818cf8;
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-danger: #ef4444;
        }

        /* Base Styles */
        body {
            background-color: var(--color-bg-primary);
            color: #f8fafc;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        /* Animated Background Mesh */
        .mesh-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            background: 
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            opacity: 0.6;
        }
        
        .mesh-blob {
            position: absolute;
            filter: blur(80px);
            opacity: 0.4;
            animation: float 10s infinite ease-in-out;
        }

        .blob-1 { top: 10%; left: 10%; width: 300px; height: 300px; background: #4f46e5; animation-delay: 0s; }
        .blob-2 { top: 60%; right: 10%; width: 400px; height: 400px; background: #7c3aed; animation-delay: -2s; }
        .blob-3 { bottom: 10%; left: 40%; width: 350px; height: 350px; background: #db2777; animation-delay: -4s; }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
        }

        /* Glassmorphism */
        .glass {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(30, 41, 59, 0.3); }
        ::-webkit-scrollbar-thumb { background: rgba(99, 102, 241, 0.5); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(99, 102, 241, 0.8); }

        /* Code Editor Simulation */
        .code-editor {
            background: #0d1117;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            line-height: 1.6;
        }
        
        .line-numbers {
            color: #484f58;
            text-align: right;
            padding-right: 16px;
            user-select: none;
            border-right: 1px solid #30363d;
        }

        /* Syntax Highlighting */
        .token-keyword { color: #ff7b72; }
        .token-function { color: #d2a8ff; }
        .token-string { color: #a5d6ff; }
        .token-comment { color: #8b949e; font-style: italic; }
        .token-number { color: #79c0ff; }

        /* Animations */
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .pulse-ring {
            position: absolute;
            border-radius: 50%;
            animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.33); }
            80%, 100% { opacity: 0; }
        }

        /* Difficulty Badges */
        .badge-easy { background: rgba(16, 185, 129, 0.15); color: #34d399; border: 1px solid rgba(16, 185, 129, 0.3); }
        .badge-medium { background: rgba(245, 158, 11, 0.15); color: #fbbf24; border: 1px solid rgba(245, 158, 11, 0.3); }
        .badge-hard { background: rgba(239, 68, 68, 0.15); color: #f87171; border: 1px solid rgba(239, 68, 68, 0.3); }

        /* Status Indicators */
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }
        .status-online { background: #10b981; box-shadow: 0 0 8px #10b981; }
        .status-offline { background: #ef4444; }
        .status-connecting { background: #f59e0b; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        /* Interactive Elements */
        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            transition: all 0.2s;
            box-shadow: 0 4px 20px rgba(79, 70, 229, 0.3);
        }
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 30px rgba(79, 70, 229, 0.5);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            border-color: rgba(99, 102, 241, 0.4);
            box-shadow: 0 10px 40px -10px rgba(99, 102, 241, 0.2);
        }

        /* Loading Skeleton */
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.03) 25%, rgba(255,255,255,0.08) 50%, rgba(255,255,255,0.03) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body class="antialiased">
    <!-- Background -->
    <div class="mesh-bg">
        <div class="mesh-blob blob-1"></div>
        <div class="mesh-blob blob-2"></div>
        <div class="mesh-blob blob-3"></div>
    </div>

    <div id="app" class="min-h-screen flex flex-col lg:flex-row">
        <!-- Sidebar -->
        <aside class="w-full lg:w-64 glass-panel border-r border-white/5 flex flex-col z-10">
            <div class="p-6 border-b border-white/5">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg shadow-indigo-500/30">
                        <i data-lucide="code-2" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400">AlgoArena</h1>
                        <p class="text-xs text-gray-500">Battle. Code. Win.</p>
                    </div>
                </div>
            </div>

            <nav class="flex-1 p-4 space-y-2">
                <button onclick="router.navigate('dashboard')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all group active-nav" data-page="dashboard">
                    <i data-lucide="layout-dashboard" class="w-5 h-5 group-hover:text-indigo-400 transition-colors"></i>
                    Dashboard
                </button>
                <button onclick="router.navigate('problems')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all group" data-page="problems">
                    <i data-lucide="book-open" class="w-5 h-5 group-hover:text-indigo-400 transition-colors"></i>
                    Problems
                </button>
                <button onclick="router.navigate('arena')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all group" data-page="arena">
                    <i data-lucide="swords" class="w-5 h-5 group-hover:text-indigo-400 transition-colors"></i>
                    Arena
                </button>
                <button onclick="router.navigate('logs')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all group" data-page="logs">
                    <i data-lucide="terminal" class="w-5 h-5 group-hover:text-indigo-400 transition-colors"></i>
                    API Logs
                </button>
            </nav>

            <div class="p-4 border-t border-white/5">
                <div class="glass rounded-xl p-4">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-xs font-medium text-gray-400 uppercase tracking-wider">Backend Status</span>
                        <span id="health-status" class="flex items-center text-xs">
                            <span class="status-dot status-connecting"></span>
                            Checking...
                        </span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500">Socket.IO</span>
                        <span id="socket-status" class="text-xs text-gray-400">Disconnected</span>
                    </div>
                    <button onclick="config.toggleMockMode()" id="mock-toggle" class="mt-3 w-full text-xs py-2 rounded-lg border border-white/10 text-gray-400 hover:text-white hover:bg-white/5 transition-colors">
                        Enable Mock Mode
                    </button>
                </div>
                
                <div class="mt-4 px-4 py-2">
                    <input type="text" id="api-base-url" placeholder="localhost:8000" value="localhost:8000" 
                           class="w-full bg-transparent text-xs text-gray-400 border-b border-white/10 focus:border-indigo-500 outline-none pb-1 transition-colors">
                    <label class="text-[10px] text-gray-600 mt-1 block">API Base URL</label>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto h-screen relative">
            <!-- Top Bar -->
            <header class="sticky top-0 z-20 glass-panel border-b border-white/5 px-6 py-4 flex items-center justify-between">
                <h2 id="page-title" class="text-xl font-semibold text-white">Dashboard</h2>
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2 text-sm text-gray-400">
                        <i data-lucide="user" class="w-4 h-4"></i>
                        <span id="current-user">Guest</span>
                    </div>
                    <button onclick="app.setUsername()" class="p-2 rounded-lg hover:bg-white/5 text-gray-400 hover:text-white transition-colors">
                        <i data-lucide="settings" class="w-4 h-4"></i>
                    </button>
                </div>
            </header>

            <div class="p-6 max-w-7xl mx-auto">
                <!-- Dashboard View -->
                <div id="view-dashboard" class="view-section space-y-6 fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="glass rounded-2xl p-6 card-hover">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 rounded-xl bg-indigo-500/20 flex items-center justify-center">
                                    <i data-lucide="database" class="w-6 h-6 text-indigo-400"></i>
                                </div>
                                <span class="text-xs text-gray-500 font-mono">GET /problems</span>
                            </div>
                            <h3 class="text-2xl font-bold text-white" id="stat-problems">0</h3>
                            <p class="text-sm text-gray-400 mt-1">Total Problems</p>
                        </div>
                        
                        <div class="glass rounded-2xl p-6 card-hover">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center">
                                    <i data-lucide="users" class="w-6 h-6 text-emerald-400"></i>
                                </div>
                                <span class="text-xs text-gray-500 font-mono">Socket.IO</span>
                            </div>
                            <h3 class="text-2xl font-bold text-white" id="stat-online">0</h3>
                            <p class="text-sm text-gray-400 mt-1">Online Users</p>
                        </div>
                        
                        <div class="glass rounded-2xl p-6 card-hover">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 rounded-xl bg-purple-500/20 flex items-center justify-center">
                                    <i data-lucide="trophy" class="w-6 h-6 text-purple-400"></i>
                                </div>
                                <span class="text-xs text-gray-500 font-mono">Rooms</span>
                            </div>
                            <h3 class="text-2xl font-bold text-white" id="stat-rooms">0</h3>
                            <p class="text-sm text-gray-400 mt-1">Active Rooms</p>
                        </div>
                    </div>

                    <div class="glass rounded-2xl p-8 text-center">
                        <div class="w-20 h-20 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 mx-auto mb-6 flex items-center justify-center shadow-2xl shadow-indigo-500/30">
                            <i data-lucide="rocket" class="w-10 h-10 text-white"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-2">Welcome to AlgoArena</h3>
                        <p class="text-gray-400 max-w-md mx-auto mb-6">Start by exploring the problem set or jump straight into the arena to battle other developers in real-time coding challenges.</p>
                        <div class="flex gap-4 justify-center">
                            <button onclick="router.navigate('problems')" class="btn-primary px-6 py-3 rounded-xl font-medium text-white flex items-center gap-2">
                                <i data-lucide="book-open" class="w-4 h-4"></i>
                                Browse Problems
                            </button>
                            <button onclick="router.navigate('arena')" class="px-6 py-3 rounded-xl font-medium text-white border border-white/10 hover:bg-white/5 transition-all flex items-center gap-2">
                                <i data-lucide="swords" class="w-4 h-4"></i>
                                Enter Arena
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Problems View -->
                <div id="view-problems" class="view-section hidden space-y-6">
                    <div class="flex flex-col md:flex-row gap-4 items-center justify-between">
                        <div class="flex gap-2">
                            <button onclick="problems.filter('all')" class="filter-btn px-4 py-2 rounded-lg text-sm font-medium bg-white/10 text-white" data-filter="all">All</button>
                            <button onclick="problems.filter('easy')" class="filter-btn px-4 py-2 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5" data-filter="easy">Easy</button>
                            <button onclick="problems.filter('medium')" class="filter-btn px-4 py-2 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5" data-filter="medium">Medium</button>
                            <button onclick="problems.filter('hard')" class="filter-btn px-4 py-2 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5" data-filter="hard">Hard</button>
                        </div>
                        <div class="relative">
                            <i data-lucide="search" class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
                            <input type="text" id="problem-search" placeholder="Search problems..." 
                                   class="pl-10 pr-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500 w-64">
                        </div>
                    </div>

                    <div id="problems-list" class="grid grid-cols-1 gap-4">
                        <!-- Problems injected here -->
                    </div>
                </div>

                <!-- Problem Detail View -->
                <div id="view-problem-detail" class="view-section hidden space-y-6">
                    <button onclick="router.navigate('problems')" class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors mb-4">
                        <i data-lucide="arrow-left" class="w-4 h-4"></i>
                        Back to Problems
                    </button>
                    
                    <div id="problem-detail-content" class="space-y-6">
                        <!-- Content injected here -->
                    </div>
                </div>

                <!-- Arena View -->
                <div id="view-arena" class="view-section hidden space-y-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Create Room -->
                        <div class="glass rounded-2xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                                <i data-lucide="plus-circle" class="w-5 h-5 text-indigo-400"></i>
                                Create Room
                            </h3>
                            <form id="create-room-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm text-gray-400 mb-2">Difficulty</label>
                                    <select id="create-difficulty" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-white focus:outline-none focus:border-indigo-500">
                                        <option value="easy">Easy</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="hard">Hard</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-2">Time Limit (seconds)</label>
                                    <input type="number" id="create-time" value="600" min="60" max="3600"
                                           class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-white focus:outline-none focus:border-indigo-500">
                                </div>
                                <button type="submit" class="btn-primary w-full py-3 rounded-xl font-medium text-white flex items-center justify-center gap-2">
                                    <i data-lucide="play" class="w-4 h-4"></i>
                                    Create Room
                                </button>
                            </form>
                        </div>

                        <!-- Join Room -->
                        <div class="glass rounded-2xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                                <i data-lucide="log-in" class="w-5 h-5 text-emerald-400"></i>
                                Join Room
                            </h3>
                            <form id="join-room-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm text-gray-400 mb-2">Room ID</label>
                                    <input type="text" id="join-room-id" placeholder="e.g., a1b2c3d4"
                                           class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-white focus:outline-none focus:border-indigo-500 font-mono uppercase">
                                </div>
                                <button type="submit" class="w-full py-3 rounded-xl font-medium text-white border border-emerald-500/50 bg-emerald-500/10 hover:bg-emerald-500/20 transition-all flex items-center justify-center gap-2">
                                    <i data-lucide="log-in" class="w-4 h-4"></i>
                                    Join Battle
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Current Room -->
                    <div id="current-room-panel" class="glass rounded-2xl p-6 hidden">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="text-lg font-semibold text-white flex items-center gap-2">
                                    <i data-lucide="shield" class="w-5 h-5 text-indigo-400"></i>
                                    Room: <span id="room-display-id" class="font-mono text-indigo-400"></span>
                                </h3>
                                <p class="text-sm text-gray-400 mt-1">Share this ID with your opponent</p>
                            </div>
                            <div id="room-status-badge" class="px-3 py-1 rounded-full text-xs font-medium bg-yellow-500/20 text-yellow-400 border border-yellow-500/30">
                                Waiting
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="bg-white/5 rounded-xl p-4">
                                <h4 class="text-xs font-medium text-gray-500 uppercase mb-3">Players</h4>
                                <div id="room-players" class="space-y-2">
                                    <!-- Players injected here -->
                                </div>
                            </div>
                            <div class="bg-white/5 rounded-xl p-4">
                                <h4 class="text-xs font-medium text-gray-500 uppercase mb-3">Challenge</h4>
                                <div id="room-problem" class="text-sm text-gray-300">
                                    <!-- Problem info -->
                                </div>
                            </div>
                        </div>

                        <div id="battle-interface" class="hidden space-y-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <div class="text-2xl font-mono font-bold text-white" id="timer">10:00</div>
                                    <div class="text-sm text-gray-400">remaining</div>
                                </div>
                                <button onclick="arena.submitCode()" class="btn-primary px-6 py-2 rounded-lg text-sm font-medium flex items-center gap-2">
                                    <i data-lucide="send" class="w-4 h-4"></i>
                                    Submit Solution
                                </button>
                            </div>
                            
                            <div class="code-editor border border-white/10 overflow-hidden">
                                <div class="flex items-center justify-between px-4 py-2 bg-white/5 border-b border-white/5">
                                    <span class="text-xs text-gray-400">solution.py</span>
                                    <div class="flex gap-2">
                                        <div class="w-3 h-3 rounded-full bg-red-500/50"></div>
                                        <div class="w-3 h-3 rounded-full bg-yellow-500/50"></div>
                                        <div class="w-3 h-3 rounded-full bg-green-500/50"></div>
                                    </div>
                                </div>
                                <div class="flex">
                                    <div class="line-numbers py-4 text-sm font-mono">
                                        <div>1</div><div>2</div><div>3</div><div>4</div><div>5</div>
                                        <div>6</div><div>7</div><div>8</div><div>9</div><div>10</div>
                                    </div>
                                    <textarea id="code-input" class="flex-1 bg-transparent p-4 text-sm font-mono text-gray-300 focus:outline-none resize-none" rows="10" spellcheck="false">def solution(nums, target):
    # Write your code here
    pass</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Logs View -->
                <div id="view-logs" class="view-section hidden">
                    <div class="glass rounded-2xl overflow-hidden">
                        <div class="flex items-center justify-between px-6 py-4 border-b border-white/5">
                            <h3 class="font-semibold text-white">API Request Logs</h3>
                            <button onclick="logs.clear()" class="text-xs text-gray-400 hover:text-white">Clear</button>
                        </div>
                        <div id="logs-container" class="divide-y divide-white/5 max-h-[600px] overflow-y-auto font-mono text-sm">
                            <div class="p-8 text-center text-gray-500">
                                <i data-lucide="terminal" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                                <p>No requests yet. Start interacting with the API.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-6 right-6 transform translate-y-20 opacity-0 transition-all duration-300 z-50">
        <div class="glass px-6 py-4 rounded-xl border-l-4 border-indigo-500 shadow-2xl flex items-center gap-3">
            <div id="toast-icon"></div>
            <div>
                <h4 id="toast-title" class="font-medium text-white">Notification</h4>
                <p id="toast-message" class="text-sm text-gray-400">Message</p>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // Configuration & State
        // ==========================================
        const config = {
            mockMode: false,
            getApiUrl: () => `http://${document.getElementById('api-base-url').value}`,
            getWsUrl: () => `ws://${document.getElementById('api-base-url').value}`,
            username: localStorage.getItem('algoarena_username') || 'Developer',
            
            toggleMockMode() {
                this.mockMode = !this.mockMode;
                document.getElementById('mock-toggle').textContent = this.mockMode ? 'Disable Mock Mode' : 'Enable Mock Mode';
                document.getElementById('mock-toggle').classList.toggle('bg-indigo-500/20', this.mockMode);
                toast.show('Mock Mode ' + (this.mockMode ? 'Enabled' : 'Disabled'), 'Mock data will be used for all requests', 'info');
                app.init();
            }
        };

        const state = {
            problems: [],
            currentRoom: null,
            socket: null,
            logs: [],
            onlineUsers: 0
        };

        // ==========================================
        // Mock Data
        // ==========================================
        const mockData = {
            problems: [
                {
                    id: 'two-sum',
                    title: 'Two Sum',
                    difficulty: 'easy',
                    description: 'Given an array of integers `nums` and an integer `target`, return indices of the two numbers such that they add up to `target`.',
                    starter_code: 'def solution(nums, target):\n    # Write your code here\n    pass',
                    public_tests: [
                        { input: { nums: [2, 7, 11, 15], target: 9 }, expected: [0, 1] }
                    ]
                },
                {
                    id: 'reverse-linked-list',
                    title: 'Reverse Linked List',
                    difficulty: 'medium',
                    description: 'Given the head of a singly linked list, reverse the list, and return the reversed list.',
                    starter_code: 'class ListNode:\n    def __init__(self, val=0, next=None):\n        self.val = val\n        self.next = next\n\ndef solution(head):\n    # Write your code here\n    pass',
                    public_tests: [
                        { input: { head: [1, 2, 3, 4, 5] }, expected: [5, 4, 3, 2, 1] }
                    ]
                },
                {
                    id: 'merge-k-sorted-lists',
                    title: 'Merge K Sorted Lists',
                    difficulty: 'hard',
                    description: 'You are given an array of `k` linked-lists, each linked-list is sorted in ascending order. Merge all the linked-lists into one sorted linked-list and return it.',
                    starter_code: 'import heapq\n\ndef solution(lists):\n    # Write your code here\n    pass',
                    public_tests: [
                        { input: { lists: [[1,4,5],[1,3,4],[2,6]] }, expected: [1,1,2,3,4,4,5,6] }
                    ]
                },
                {
                    id: 'valid-parentheses',
                    title: 'Valid Parentheses',
                    difficulty: 'easy',
                    description: 'Given a string `s` containing just the characters `(`, `)`, `{`, `}`, `[` and `]`, determine if the input string is valid.',
                    starter_code: 'def solution(s):\n    # Write your code here\n    pass',
                    public_tests: [
                        { input: { s: "()[]{}" }, expected: true }
                    ]
                },
                {
                    id: 'binary-tree-maximum-path-sum',
                    title: 'Binary Tree Maximum Path Sum',
                    difficulty: 'hard',
                    description: 'A path in a binary tree is a sequence of nodes where each pair of adjacent nodes in the sequence has an edge connecting them. Return the maximum path sum of any non-empty path.',
                    starter_code: 'class TreeNode:\n    def __init__(self, val=0, left=None, right=None):\n        self.val = val\n        self.left = left\n        self.right = right\n\ndef solution(root):\n    # Write your code here\n    pass',
                    public_tests: [
                        { input: { root: [1,2,3] }, expected: 6 }
                    ]
                }
            ],
            rooms: {}
        };

        // ==========================================
        // API Client
        // ==========================================
        const api = {
            async request(method, endpoint, data = null) {
                const url = `${config.getApiUrl()}${endpoint}`;
                const startTime = performance.now();
                
                try {
                    let response;
                    
                    if (config.mockMode) {
                        await new Promise(r => setTimeout(r, 300)); // Simulate latency
                        response = await this.mockRequest(method, endpoint, data);
                    } else {
                        const options = {
                            method,
                            headers: { 'Content-Type': 'application/json' }
                        };
                        if (data) options.body = JSON.stringify(data);
                        response = await fetch(url, options);
                        if (!response.ok) throw new Error(`HTTP ${response.status}`);
                        response = await response.json();
                    }
                    
                    const duration = (performance.now() - startTime).toFixed(0);
                    logs.add(method, endpoint, duration, 'success');
                    return response;
                    
                } catch (error) {
                    const duration = (performance.now() - startTime).toFixed(0);
                    logs.add(method, endpoint, duration, 'error', error.message);
                    toast.show('Error', error.message, 'error');
                    throw error;
                }
            },

            async mockRequest(method, endpoint, data) {
                // Mock implementation
                if (endpoint === '/health') return { status: 'ok', service: 'algoarena-backend' };
                if (endpoint === '/problems') return { items: mockData.problems, count: mockData.problems.length };
                if (endpoint.startsWith('/problems/')) {
                    const id = endpoint.split('/')[2];
                    const problem = mockData.problems.find(p => p.id === id);
                    if (!problem) throw new Error('Problem not found');
                    return problem;
                }
                if (endpoint === '/rooms' && method === 'POST') {
                    const roomId = Math.random().toString(36).substring(2, 10);
                    const room = {
                        room_id: roomId,
                        status: 'waiting',
                        created_at: new Date().toISOString(),
                        time_limit_sec: data.time_limit_sec,
                        problem: mockData.problems.find(p => p.difficulty === data.difficulty) || mockData.problems[0],
                        players: [{ username: config.username, joined_at: new Date().toISOString() }]
                    };
                    mockData.rooms[roomId] = room;
                    return room;
                }
                if (endpoint.includes('/join') && method === 'POST') {
                    const roomId = endpoint.split('/')[2];
                    const room = mockData.rooms[roomId];
                    if (!room) throw new Error('Room not found');
                    if (room.players.length >= 2) throw new Error('Room full');
                    room.players.push({ username: data.username, joined_at: new Date().toISOString() });
                    room.status = 'active';
                    return room;
                }
                if (endpoint.startsWith('/rooms/') && method === 'GET') {
                    const roomId = endpoint.split('/')[2];
                    return mockData.rooms[roomId] || null;
                }
                throw new Error('Endpoint not implemented in mock mode');
            },

            health() { return this.request('GET', '/health'); },
            getProblems(difficulty) { 
                const query = difficulty && difficulty !== 'all' ? `?difficulty=${difficulty}` : '';
                return this.request('GET', `/problems${query}`);
            },
            getProblem(id) { return this.request('GET', `/problems/${id}`); },
            createRoom(data) { return this.request('POST', '/rooms', data); },
            joinRoom(roomId, username) { return this.request('POST', `/rooms/${roomId}/join`, { username }); },
            getRoom(roomId) { return this.request('GET', `/rooms/${roomId}`); }
        };

        // ==========================================
        // Socket.IO Handler
        // ==========================================
        const socketHandler = {
            connect() {
                if (config.mockMode) {
                    state.socket = { connected: true, mock: true };
                    this.updateStatus('connected');
                    toast.show('Mock Socket', 'Connected in mock mode', 'success');
                    return;
                }

                try {
                    state.socket = io(config.getApiUrl());
                    
                    state.socket.on('connect', () => {
                        this.updateStatus('connected');
                        state.socket.emit('identify', { username: config.username });
                    });
                    
                    state.socket.on('disconnect', () => this.updateStatus('disconnected'));
                    state.socket.on('connect_error', () => this.updateStatus('error'));
                    
                    state.socket.on('identified', (data) => {
                        console.log('Identified:', data);
                    });
                    
                    state.socket.on('room_update', (data) => {
                        arena.handleRoomUpdate(data);
                    });
                    
                    state.socket.on('error', (data) => {
                        toast.show('Socket Error', data.detail, 'error');
                    });
                    
                } catch (e) {
                    console.error('Socket connection failed:', e);
                    this.updateStatus('error');
                }
            },

            updateStatus(status) {
                const el = document.getElementById('socket-status');
                const dot = document.querySelector('#health-status .status-dot');
                
                if (status === 'connected') {
                    el.textContent = 'Connected';
                    el.className = 'text-xs text-emerald-400';
                    dot.className = 'status-dot status-online';
                } else if (status === 'disconnected') {
                    el.textContent = 'Disconnected';
                    el.className = 'text-xs text-gray-400';
                    dot.className = 'status-dot status-offline';
                } else {
                    el.textContent = 'Error';
                    el.className = 'text-xs text-red-400';
                    dot.className = 'status-dot status-offline';
                }
            },

            joinRoom(roomId) {
                if (state.socket?.mock) {
                    // Mock socket join
                    setTimeout(() => {
                        const room = mockData.rooms[roomId];
                        if (room && room.players.length === 1) {
                            room.players.push({ username: 'Opponent', joined_at: new Date().toISOString() });
                            room.status = 'active';
                            arena.handleRoomUpdate({
                                room_id: roomId,
                                status: 'active',
                                players: room.players.map(p => p.username)
                            });
                        }
                    }, 2000);
                    return;
                }
                if (state.socket) {
                    state.socket.emit('join_room', { room_id: roomId });
                }
            }
        };

        // ==========================================
        // Router
        // ==========================================
        const router = {
            currentPage: 'dashboard',
            
            navigate(page) {
                // Hide all views
                document.querySelectorAll('.view-section').forEach(el => {
                    el.classList.add('hidden');
                    el.classList.remove('fade-in');
                });
                
                // Show target view
                const target = document.getElementById(`view-${page}`);
                if (target) {
                    target.classList.remove('hidden');
                    target.classList.add('fade-in');
                }
                
                // Update nav
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active-nav', 'text-white', 'bg-white/5');
                    btn.classList.add('text-gray-400');
                    if (btn.dataset.page === page) {
                        btn.classList.add('active-nav', 'text-white', 'bg-white/5');
                        btn.classList.remove('text-gray-400');
                    }
                });
                
                // Update title
                const titles = {
                    dashboard: 'Dashboard',
                    problems: 'Problem Set',
                    'problem-detail': 'Problem Details',
                    arena: 'Battle Arena',
                    logs: 'API Logs'
                };
                document.getElementById('page-title').textContent = titles[page] || 'AlgoArena';
                
                this.currentPage = page;
                
                // Initialize page data
                if (page === 'problems') problems.load();
                if (page === 'dashboard') dashboard.load();
            }
        };

        // ==========================================
        // Views
        // ==========================================
        const dashboard = {
            async load() {
                try {
                    const health = await api.health();
                    document.getElementById('health-status').innerHTML = 
                        `<span class="status-dot status-online"></span>Online`;
                    
                    const problems = await api.getProblems();
                    document.getElementById('stat-problems').textContent = problems.count;
                    document.getElementById('stat-online').textContent = Math.floor(Math.random() * 50) + 10;
                    document.getElementById('stat-rooms').textContent = Object.keys(mockData.rooms).length;
                } catch (e) {
                    document.getElementById('health-status').innerHTML = 
                        `<span class="status-dot status-offline"></span>Offline`;
                }
            }
        };

        const problems = {
            currentFilter: 'all',
            
            async load() {
                const container = document.getElementById('problems-list');
                container.innerHTML = '<div class="skeleton h-20 rounded-xl"></div>'.repeat(3);
                
                try {
                    const data = await api.getProblems(this.currentFilter === 'all' ? null : this.currentFilter);
                    state.problems = data.items;
                    this.render(data.items);
                } catch (e) {
                    container.innerHTML = '<div class="text-center text-red-400 py-8">Failed to load problems</div>';
                }
            },
            
            render(items) {
                const container = document.getElementById('problems-list');
                if (!items.length) {
                    container.innerHTML = '<div class="text-center text-gray-500 py-8">No problems found</div>';
                    return;
                }
                
                container.innerHTML = items.map(p => `
                    <div class="glass rounded-xl p-6 card-hover cursor-pointer group" onclick="problems.viewDetail('${p.id}')">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 rounded-lg bg-white/5 flex items-center justify-center group-hover:bg-indigo-500/20 transition-colors">
                                    <i data-lucide="code" class="w-5 h-5 text-gray-400 group-hover:text-indigo-400"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium text-white group-hover:text-indigo-300 transition-colors">${p.title}</h4>
                                    <p class="text-sm text-gray-500">${p.id}</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <span class="badge-${p.difficulty} px-3 py-1 rounded-full text-xs font-medium capitalize">
                                    ${p.difficulty}
                                </span>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-gray-600 group-hover:text-white transition-colors"></i>
                            </div>
                        </div>
                    </div>
                `).join('');
                lucide.createIcons();
            },
            
            filter(difficulty) {
                this.currentFilter = difficulty;
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('bg-white/10', 'text-white');
                    btn.classList.add('text-gray-400');
                    if (btn.dataset.filter === difficulty) {
                        btn.classList.add('bg-white/10', 'text-white');
                        btn.classList.remove('text-gray-400');
                    }
                });
                this.load();
            },
            
            async viewDetail(id) {
                router.navigate('problem-detail');
                const container = document.getElementById('problem-detail-content');
                container.innerHTML = '<div class="skeleton h-40 rounded-xl"></div>';
                
                try {
                    const problem = await api.getProblem(id);
                    container.innerHTML = `
                        <div class="glass rounded-2xl p-8">
                            <div class="flex items-center gap-3 mb-6">
                                <span class="badge-${problem.difficulty} px-3 py-1 rounded-full text-xs font-medium capitalize">
                                    ${problem.difficulty}
                                </span>
                                <span class="text-sm text-gray-500 font-mono">${problem.id}</span>
                            </div>
                            <h2 class="text-3xl font-bold text-white mb-6">${problem.title}</h2>
                            <div class="prose prose-invert max-w-none mb-8 text-gray-300 leading-relaxed">
                                ${problem.description}
                            </div>
                            
                            <div class="space-y-6">
                                <div>
                                    <h4 class="text-sm font-medium text-gray-400 mb-3 uppercase tracking-wider">Starter Code</h4>
                                    <div class="code-editor border border-white/10 overflow-hidden">
                                        <div class="flex items-center justify-between px-4 py-2 bg-white/5 border-b border-white/5">
                                            <span class="text-xs text-gray-400">solution.py</span>
                                        </div>
                                        <pre class="p-4 text-sm font-mono text-gray-300 overflow-x-auto">${problem.starter_code}</pre>
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 class="text-sm font-medium text-gray-400 mb-3 uppercase tracking-wider">Example Test Case</h4>
                                    <div class="bg-white/5 rounded-xl p-4 font-mono text-sm">
                                        <div class="text-gray-500 mb-2">Input:</div>
                                        <div class="text-indigo-300 mb-4">${JSON.stringify(problem.public_tests[0].input, null, 2)}</div>
                                        <div class="text-gray-500 mb-2">Expected Output:</div>
                                        <div class="text-emerald-300">${JSON.stringify(problem.public_tests[0].expected)}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } catch (e) {
                    container.innerHTML = '<div class="text-red-400">Failed to load problem details</div>';
                }
            }
        };

        const arena = {
            currentRoom: null,
            
            init() {
                document.getElementById('create-room-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const data = {
                        username: config.username,
                        difficulty: document.getElementById('create-difficulty').value,
                        time_limit_sec: parseInt(document.getElementById('create-time').value)
                    };
                    
                    try {
                        const room = await api.createRoom(data);
                        this.enterRoom(room);
                        toast.show('Room Created', `Room ID: ${room.room_id}`, 'success');
                    } catch (e) {
                        console.error(e);
                    }
                });
                
                document.getElementById('join-room-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const roomId = document.getElementById('join-room-id').value.trim();
                    if (!roomId) return;
                    
                    try {
                        await api.joinRoom(roomId, config.username);
                        const room = await api.getRoom(roomId);
                        this.enterRoom(room);
                        socketHandler.joinRoom(roomId);
                        toast.show('Joined Room', `Welcome to ${roomId}`, 'success');
                    } catch (e) {
                        console.error(e);
                    }
                });
            },
            
            enterRoom(room) {
                this.currentRoom = room;
                state.currentRoom = room;
                document.getElementById('current-room-panel').classList.remove('hidden');
                document.getElementById('room-display-id').textContent = room.room_id;
                this.updateRoomDisplay(room);
                
                // Join socket room
                socketHandler.joinRoom(room.room_id);
            },
            
            updateRoomDisplay(room) {
                // Update status badge
                const badge = document.getElementById('room-status-badge');
                badge.textContent = room.status;
                badge.className = `px-3 py-1 rounded-full text-xs font-medium capitalize border ${
                    room.status === 'active' ? 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30' :
                    room.status === 'waiting' ? 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30' :
                    'bg-red-500/20 text-red-400 border-red-500/30'
                }`;
                
                // Update players
                const playersContainer = document.getElementById('room-players');
                playersContainer.innerHTML = room.players.map((p, i) => `
                    <div class="flex items-center gap-3 p-3 rounded-lg ${p.username === config.username ? 'bg-indigo-500/20 border border-indigo-500/30' : 'bg-white/5'}">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-xs font-bold">
                            ${p.username[0].toUpperCase()}
                        </div>
                        <div class="flex-1">
                            <div class="text-sm text-white">${p.username} ${p.username === config.username ? '(You)' : ''}</div>
                            <div class="text-xs text-gray-500">${i === 0 ? 'Host' : 'Challenger'}</div>
                        </div>
                        ${room.status === 'active' && i === 1 ? '<div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>' : ''}
                    </div>
                `).join('');
                
                // Update problem
                document.getElementById('room-problem').innerHTML = `
                    <div class="font-medium text-white">${room.problem.title}</div>
                    <div class="text-xs text-gray-500 mt-1 capitalize">${room.problem.difficulty}  ${room.time_limit_sec}s</div>
                `;
                
                // Show battle interface if active
                if (room.status === 'active') {
                    document.getElementById('battle-interface').classList.remove('hidden');
                    this.startTimer(room.time_limit_sec);
                }
            },
            
            handleRoomUpdate(data) {
                if (!this.currentRoom || this.currentRoom.room_id !== data.room_id) return;
                
                this.currentRoom.status = data.status;
                if (data.players) {
                    this.currentRoom.players = data.players.map(username => ({
                        username,
                        joined_at: new Date().toISOString()
                    }));
                }
                
                this.updateRoomDisplay(this.currentRoom);
                
                if (data.message) {
                    toast.show('Room Update', data.message, 'info');
                }
            },
            
            startTimer(seconds) {
                const timerEl = document.getElementById('timer');
                let remaining = seconds;
                
                const interval = setInterval(() => {
                    if (!this.currentRoom || this.currentRoom.status !== 'active') {
                        clearInterval(interval);
                        return;
                    }
                    
                    remaining--;
                    const mins = Math.floor(remaining / 60);
                    const secs = remaining % 60;
                    timerEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                    
                    if (remaining <= 0) {
                        clearInterval(interval);
                        toast.show('Time\'s Up!', 'The battle has ended', 'warning');
                    }
                }, 1000);
            },
            
            submitCode() {
                toast.show('Submitted', 'Your solution has been submitted!', 'success');
            }
        };

        const logs = {
            add(method, endpoint, duration, status, error = null) {
                const entry = { method, endpoint, duration, status, error, time: new Date().toLocaleTimeString() };
                state.logs.unshift(entry);
                this.render();
            },
            
            render() {
                const container = document.getElementById('logs-container');
                if (!state.logs.length) return;
                
                container.innerHTML = state.logs.map(log => `
                    <div class="px-6 py-4 flex items-center justify-between hover:bg-white/5 transition-colors">
                        <div class="flex items-center gap-4">
                            <span class="text-xs font-mono px-2 py-1 rounded ${
                                log.method === 'GET' ? 'bg-blue-500/20 text-blue-400' :
                                log.method === 'POST' ? 'bg-emerald-500/20 text-emerald-400' :
                                'bg-gray-500/20 text-gray-400'
                            }">${log.method}</span>
                            <span class="text-sm text-gray-300">${log.endpoint}</span>
                        </div>
                        <div class="flex items-center gap-4">
                            ${log.error ? `<span class="text-xs text-red-400">${log.error}</span>` : ''}
                            <span class="text-xs text-gray-500">${log.duration}ms</span>
                            <span class="text-xs ${log.status === 'success' ? 'text-emerald-400' : 'text-red-400'}">
                                ${log.status === 'success' ? '200 OK' : 'ERROR'}
                            </span>
                        </div>
                    </div>
                `).join('');
            },
            
            clear() {
                state.logs = [];
                document.getElementById('logs-container').innerHTML = `
                    <div class="p-8 text-center text-gray-500">
                        <i data-lucide="terminal" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                        <p>No requests yet. Start interacting with the API.</p>
                    </div>
                `;
                lucide.createIcons();
            }
        };

        // ==========================================
        // UI Utilities
        // ==========================================
        const toast = {
            show(title, message, type = 'info') {
                const el = document.getElementById('toast');
                const iconEl = document.getElementById('toast-icon');
                
                const icons = {
                    success: '<i data-lucide="check-circle" class="w-6 h-6 text-emerald-400"></i>',
                    error: '<i data-lucide="x-circle" class="w-6 h-6 text-red-400"></i>',
                    warning: '<i data-lucide="alert-triangle" class="w-6 h-6 text-yellow-400"></i>',
                    info: '<i data-lucide="info" class="w-6 h-6 text-indigo-400"></i>'
                };
                
                iconEl.innerHTML = icons[type];
                document.getElementById('toast-title').textContent = title;
                document.getElementById('toast-message').textContent = message;
                
                el.classList.remove('translate-y-20', 'opacity-0');
                lucide.createIcons();
                
                setTimeout(() => {
                    el.classList.add('translate-y-20', 'opacity-0');
                }, 4000);
            }
        };

        const app = {
            init() {
                document.getElementById('current-user').textContent = config.username;
                socketHandler.connect();
                arena.init();
                router.navigate('dashboard');
                
                // Check health periodically
                setInterval(() => dashboard.load(), 10000);
            },
            
            setUsername() {
                const newName = prompt('Enter your username:', config.username);
                if (newName) {
                    config.username = newName;
                    localStorage.setItem('algoarena_username', newName);
                    document.getElementById('current-user').textContent = newName;
                    toast.show('Updated', `Username set to ${newName}`, 'success');
                }
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            app.init();
        });

        // Search functionality
        document.getElementById('problem-search')?.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = state.problems.filter(p => 
                p.title.toLowerCase().includes(term) || 
                p.id.toLowerCase().includes(term)
            );
            problems.render(filtered);
        });
    </script>
</body>
</html>